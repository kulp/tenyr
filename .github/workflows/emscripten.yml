name: Emscripten

on:
  push:
    branches: [ develop ]
  pull_request:
    branches: [ develop ]

env:
  SDL: 0
  JIT: 0
  PEDANTIC: 0
  PLATFORM: emscripten
  EM_VERSION: 1.38.46
  EM_CACHE_FOLDER: 'emsdk-cache'

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        submodules: true
    - name: Set up cache
      id: cache-system-libraries
      uses: actions/cache@v2.1.6
      with:
        path: ${{env.EM_CACHE_FOLDER}}
        key: ${{env.EM_VERSION}}-${{ runner.os }}
    - uses: mymindstorm/setup-emsdk@v10
      with:
        version: ${{env.EM_VERSION}}
        actions-cache-folder: ${{env.EM_CACHE_FOLDER}}
    - run: make -j
    - run: make check_sw

